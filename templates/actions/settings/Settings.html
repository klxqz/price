<style type="text/css">
    .plugin-menu{
        float: right;
        list-style: none;
    }

    .plugin-menu li{
        float: left;
        margin-left: 10px;
    }

    div.geshifilter {
        background-color: #f8f8f8;
        border: 1px solid #ccc;
        color: #222;
        display: block;
        line-height: 1.3;
        margin: 0.5em;
        overflow: auto;
        padding: 0.5em;
    }
</style>
<h1>Мульти Цены</h1>


<ul class="plugin-menu">
    <li><a href="mailto:support@wa-plugins.ru">Поддержка разработчика плагина</a></li>
</ul>


<div class="fields form">
    <form action="?plugin=price&action=save" method="post" id="plugins-settings-form">
        {$wa->csrf()}


        <div {if empty($settings.status)} style="display:none"{/if}>
            {literal}
                <p><b>{shopPricePlugin::prepareProducts($products)}</b> - код для преобразования цен в списке товаров, возвращает список товаров в преобразованными ценами.</p>
                <p>
                    Пример использования кода для замены цен на главной странице в списке товаров хиты продаж(список товаров bestsellers):
                </p>
                <div class="geshifilter">
                    <pre>
{$bestsellers = $wa->shop->productSet('bestsellers')}
{$bestsellers = shopPricePlugin::prepareProducts($bestsellers)}
                    </pre>
                </div>

                <p><b>{shopPricePlugin::fixTotalCart()}</b> - код для получения общей суммы товаров в корзине с исправленной ценой.</p>
            {/literal}
        </div>


        <div class="field-group">
            <div class="field">
                <div class="name">
                    Статус плагина
                </div>
                <div class="value no-shift s-ibutton-checkbox">
                    <input type="hidden" name="shop_price[status]" value="0">
                    <input type="checkbox" id="ibutton-status" name="shop_price[status]" value="1"{if $settings.status|default:0} checked{/if}>

                </div>
            </div>
        </div>


        {foreach $domain_routes as $domain => $routes}
            {foreach $routes as $route}
                {$domain_route = "`$domain`/`$route.url`"}
                {$domain_hash = md5($domain_route)}
                {$local_settings = $domain_settings[$domain_hash]}


                <div class="field-group"{if empty($settings.status)} style="display:none"{/if}>

                    <div class="field">
                        <div class="name bold">
                            Поселение: {$domain_route}
                        </div>
                        <div class="value">
                            <input type="hidden" name="domains_settings[{$domain_hash}][status]" value="0" >
                            <input type="checkbox" class="ibutton-status-parent" name="domains_settings[{$domain_hash}][status]" value="1"{if $local_settings.status|default:0} checked{/if}>
                        </div>
                    </div>

                    <div class="field"{if empty($local_settings.status)} style="display:none"{/if}>
                        <div class="name">
                            Типы цен
                        </div>
                        <div class="value">
                            <table id="price-table" class="zebra" style="width: auto;">
                                <thead>
                                <th>Цена</th>
                                <th>Группа</th>
                                <th>Удалить</th>
                                </thead>
                                <tbody>
                                    {foreach $local_settings.prices as $price}
                                        <tr>
                                            <td>
                                                <input type="text" name="domains_settings[{$domain_hash}][price_name][]" value="{$price.name|escape}" />
                                            </td>
                                            <td>
                                                <select name="domains_settings[{$domain_hash}][price_category_id][]">
                                                    {foreach $categories as $category}
                                                        <option {if $price.category_id == $category.id}selected{/if} value="{$category.id}">{$category.name|escape}</option>
                                                    {/foreach}
                                                </select>
                                            </td>
                                            <td  class="min-width">
                                                <a class="delete-row" href="#"><i class="icon16 delete"></i></a>
                                            </td>
                                        </tr>
                                    {/foreach}
                                </tbody>
                            </table>
                            <a class="inline-link add-row" data-domain-hash="{$domain_hash}" href="#"><i class="icon16 add"></i><b><i>Добавить</i></b></a>
                        </div>
                    </div>
                </div>
            {/foreach}
        {/foreach}

        <div class="field-group"{if empty($settings.status)} style="display:none"{/if}>
            <div class="field">
                <div class="value" >
                    <input type="checkbox" id="reset_checkbox" name="reset" /><label for="reset_checkbox"> - сбросить все настройки</label>
                </div>
            </div>
        </div>


        <div class="field-group"{if empty($settings.status)} style="display:none"{/if}>
            <div class="field">
                <div class="value submit">
                    <input type="submit" class="button green" value="Сохранить">
                    <span id="plugins-settings-form-status" style="display:none">
                        <i style="vertical-align:middle" class="icon16 yes"></i> [`Saved`]
                    </span>
                </div>
            </div>
        </div>
    </form>
</div>

<script type="text/javascript" src="{$wa_url}wa-content/js/jquery-plugins/jquery.tmpl.min.js"></script>
{literal}
    <script id="price-tmpl" type="text/x-jquery-tmpl">
        <tr>
        <td>
        <input type="text" name="domains_settings[${domain_hash}][price_name][]" value="" />
        </td>
        <td>
        <select name="domains_settings[${domain_hash}][price_category_id][]">
        {{each categories}}
        <option  value="${$value.id}">${$value.name}</option>
        {{/each}}
        </select>
        </td>
        <td  class="min-width">
        <a class="delete-row" href="#"><i class="icon16 delete"></i></a>
        </td>
        </tr>
    </script>
{/literal}


<script type="text/javascript" src="{$wa_app_static_url}plugins/price/js/price_settings.js"></script>
<script type="text/javascript">
    $.price_plugin.init({
        categories: {json_encode($categories)}
    });
</script>

